var TotalPoll={Editor:{pollId:false},API:{},VERSION:3,i18n:i18nTotalPoll};TotalPoll.API.Container=function(b,a){var c=this;this.options=a||{};this.templates={};this.containables={};this.$el=jQuery(b);this.$container=this.$el.find(this.options.items.container);this.sortable=this.$container.attr(this.options.items.sortableAttr)!==undefined;jQuery(this.options.templates.item).each(function(){var d=jQuery(this).data(c.options.templates.dataNameAttr);c.templates[d]=jQuery(this).html().replace(/(\r\n|\n|\r)/gm,"").trim()});this.$el.on("click",this.options.buttons,function(){c.insert(c.templates[jQuery(this).val()])});this.$el.find(this.options.items.item.container).each(function(){c.insert(jQuery(this))});return this};TotalPoll.API.Container.prototype.insert=function(c){var b;var d;if(typeof c==="string"){d=Date.now();b=this.$container.find(this.options.items.item.container).length}else{d=c.attr(this.options.items.item.idAttr);b=c.index()}var a=new TotalPoll.API.Containable(d,c,b,this);this.containables[d]=a;this.$container.append(a.$el);this.containables[d].rich();if(this.sortable){this.sort()}return this.containables[d]};TotalPoll.API.Container.prototype.sort=function(){var b=this;if(this.$container.data("sortableInstance")!==undefined){this.$container.sortable("option","start")();this.$container.sortable("option","stop")();this.$container.sortable("refresh");return}this.options.items.sortable.start=function(){b.$container.find('input[type="radio"],input[type="checkbox"]').each(function(){jQuery(this).data("wasChecked",jQuery(this).is(":checked"))})};this.options.items.sortable.stop=function(){if(typeof tinymce.editors!=="undefined"){jQuery(tinymce.editors).each(function(){var c="#wp-"+this.settings.id+"-wrap.tmce-active";this.destroy();setTimeout(function(){jQuery(c).find(".switch-tmce").click()},100)})}b.refresh()};var a=this.$container.sortable(this.options.items.sortable);a.disableSelection();this.$container.data("sortableInstance",a);return};TotalPoll.API.Container.prototype.refresh=function(){this.$container.find(this.options.items.item.container).each(function(){var a=jQuery(this);a.find("[data-rename]").each(function(){var c=jQuery(this);var b=c.data("wasChecked");c.attr("name",c.attr("data-rename").replace(/\{\{new-index\}\}/gi,a.index()));if(b!==undefined){c[0].checked=b}})})};TotalPoll.API.Containable=function(e,c,a,b){var d=this;this.id=e;this.parent=b;if(typeof c==="string"){this.$el=jQuery(c.replace(/\{\{index\}\}/gi,a).replace(/\{\{id\}\}/gi,this.id))}else{this.$el=c}this.$content=this.$el.find(b.options.items.item.content);this.$handle=this.$el.find(b.options.items.item.handle);this.$remove=this.$el.find(b.options.items.item.remove);this.$preview=this.$el.find(this.parent.options.items.item.preview);this.$previewSource=this.$el.find(b.options.items.item.previewSource);this.$upload=this.$el.find(b.options.items.item.upload.button);this.$previewSource.on("change keyup keydown",function(){d.preview()}).trigger("change");this.$remove.on("click",function(){d.remove();b.refresh()});this.$handle.on("click",function(f){if(f.target==f.delegateTarget||f.target==d.$preview[0]){d.toggle()}});this.$upload.each(function(){var g=jQuery(this);var f={$id:d.$el.find(g.attr(d.parent.options.items.item.upload.idAttr)),$label:d.$el.find(g.attr(d.parent.options.items.item.upload.labelAttr)),$sizes:d.$el.find(g.attr(d.parent.options.items.item.upload.sizesAttr)),$full:d.$el.find(g.attr(d.parent.options.items.item.upload.fullAttr)),$thumbnail:d.$el.find(g.attr(d.parent.options.items.item.upload.thumbnailAttr))};g.on("click",function(){var h=g.attr(d.parent.options.items.item.upload.typeAttr);d.upload(h,f)});d._uploadSizesHandler(f)});return this};TotalPoll.API.Containable.prototype.upload=function(b,a){var c=this;TotalPoll.Media.open(b,function(){c._uploadHandle.call(c,a,this)})};TotalPoll.API.Containable.prototype._uploadHandle=function(b,c){var d=c.get("selection").first();if(d.attributes.sizes){b.$sizes.empty();var a=jQuery.map(d.attributes.sizes,function(f,e){var g=jQuery("<option></option>",{value:f.url}).text(e);return g});b.$sizes.append(a).trigger("change")}b.$full.val(d.attributes.url);if(!b.$label.val()){b.$label.val(d.attributes.title||d.attributes.name).trigger("change")}b.$id.val(d.attributes.id)};TotalPoll.API.Containable.prototype._uploadSizesHandler=function(a){a.$sizes.off("change").on("change",function(){a.$thumbnail.val(jQuery(this).val())})};TotalPoll.API.Containable.prototype.preview=function(){var a=this.$previewSource.val();this.$preview.text(a.substr(0,30)+(a.length>30?"...":""));return true};TotalPoll.API.Containable.prototype.remove=function(){if(confirm(TotalPoll.i18n.sure)){this.$el.remove();delete this.parent.containables[this.id]}return false};TotalPoll.API.Containable.prototype.toggle=function(){if(!this.$el.hasClass("ui-sortable-helper")){this.$content.toggle(0,jQuery.proxy(function(){this.$el.toggleClass(this.parent.options.items.item.toggleClass)},this))}return false};TotalPoll.API.Containable.prototype.rich=function(){if(this.$el.find(".wp-editor-area").length>0){var b="tinymce-"+this.id;var a=jQuery.extend(true,{},tinyMCEPreInit.mceInit.totalpollTinyMceTemplate);a.selector="#"+b;tinyMCEPreInit.mceInit[b]=a;tinymce.init(a);quicktags({id:b,buttons:tinyMCEPreInit.qtInit.totalpollTinyMceTemplate.buttons});QTags._buttonsInit()}};TotalPoll.API.Media=function(){this._frame=false;return this};TotalPoll.API.Media.prototype.frame=function(a){if(!this._frame){this._frame=wp.media({title:wp.media.view.l10n.insertMediaTitle,multiple:false,library:{type:a}})}if(a!==this._frame.options.library.type){this._frame=false;this.frame(a)}return this._frame};TotalPoll.API.Media.prototype.open=function(a,b){this.frame(a).open();if(typeof b==="function"){this._frame.state("library").off("select").on("select",b)}};TotalPoll.API.Tabs=function(b,a){var c=this;this.$el=jQuery(b);this.options=a||{};this.$el.on("click","[%attr%]".replace("%attr%",this.options.tabAttr),function(d){c.tab(this);return false})};TotalPoll.API.Tabs.prototype.tab=function(d){var f=jQuery(d);var c=f.parent().find("> [%attr%]".replace("%attr%",this.options.tabAttr));var b='[%attr%="%val%"]'.replace("%attr%",this.options.tabContentAttr).replace("%val%",f.attr(this.options.tabAttr));var a=jQuery(b);var e=a.parent().find("> [%attr%]".replace("%attr%",this.options.tabContentAttr));c.removeClass("active");f.addClass("active");e.removeClass("active");a.addClass("active")};TotalPoll.API.Toggleables=function(b,a){var c=this;this.$el=jQuery(b);this.options=a||{};this.$el.on("click change","[%attr%]".replace("%attr%",this.options.toggleAttr),function(d){if(d.type==="click"&&d.target.tagName==="INPUT"){return true}c.toggle(this,d);if(d.type==="click"&&(d.target.tagName==="A"||d.target.tagName==="BUTTON")){return false}})};TotalPoll.API.Toggleables.prototype.toggle=function(c,d){var a='[%attr%="%val%"]'.replace("%attr%",this.options.toggleableAttr).replace("%val%",jQuery(c).attr(this.options.toggleAttr));var b=this.$el.find(a);var e=!b.data("toggled");if(d.target["tagName"]==="INPUT"){e=d.target.checked}b[e?"addClass":"removeClass"]("active").data("toggled",e)};TotalPoll.API.Paginate=function(b,a){var c=this;this.options=a||{};this.$el=jQuery(b);this.$body=this.$el.find(this.options.body);this.$buttons=this.$el.find(this.options.buttons);this.$next=this.$buttons.filter(this.options.next);this.$previous=this.$buttons.filter(this.options.previous);this.$last=this.$buttons.filter(this.options.last);this.$first=this.$buttons.filter(this.options.first);this.count=this.$el.find(this.options.count).val();this.action=this.$el.find(this.options.action).val();this.$buttons.on("click",function(d){c.seek(jQuery(this).val());return false})};TotalPoll.API.Paginate.prototype.refreshToggleables=function(){this.$el.find("input").change()};TotalPoll.API.Paginate.prototype.seek=function(b){var c=this;this.$buttons.attr("disabled","disabled");this.$body.css("opacity",0.5);var a={action:this.action,page:b,poll_id:TotalPoll.Editor.pollId};jQuery.post(ajaxurl,a,function(d){if(d.success===true){c.$body.html(d.data.items);c.$body.css("opacity",1);c.refreshToggleables();c.$last.add(c.$next)[d.data.last?"attr":"removeAttr"]("disabled","disabled");c.$first.add(c.$previous)[d.data.first?"attr":"removeAttr"]("disabled","disabled");c.$next.val(d.data.next);c.$previous.val(d.data.previous)}else{alert(d.data.message)}})};TotalPoll.API.Statistics=function(b,a){var c=this;this.options=a||{};this.$el=jQuery(b);this.$progressbar=this.$el.find(this.options.progressBar);this.action=this.$el.find(this.options.action).val();this.request={action:this.action,poll_id:TotalPoll.Editor.pollId};this.process=function(){jQuery.post(ajaxurl,c.request,function(d){if(d.success===true){if(d.data["continue"]===false){c.$el.html(d.data.body);TotalPoll.readyCallback.charts()}else{c.$progressbar.css("width",d.data.percentage+"%");c.process()}}else{alert(d.data.message)}})};if(this.$progressbar.length!==0){this.process()}};TotalPoll.API.Chart=function(b,a){var c=this;this.options=a||{};this.$el=jQuery(b);this.data=JSON.parse(this.$el.attr(this.options.dataAttr)||"[]");this.type=this.$el.attr(this.options.typeAttr)||"LineChart";this.instance=new google.visualization[this.type](this.$el.get(0));this.instance.draw(google.visualization.arrayToDataTable(this.data),a.chartOptions[this.type])};TotalPoll.Media=new TotalPoll.API.Media;TotalPoll.onReady=function(){TotalPoll.Editor.pollId=jQuery("#post_ID").val();var f={items:{container:"[data-tp-containables]",sortableAttr:"data-tp-sortable",item:{idAttr:"data-tp-containable",container:"[data-tp-containable]",content:".containable-content",toggleClass:"active",handle:"[data-tp-containable-handle]",remove:"[data-tp-containable-remove]",preview:"[data-tp-containable-preview]",previewSource:"[data-tp-containable-preview-field]",upload:{button:"[data-tp-containable-upload]",typeAttr:"data-tp-containable-upload-type",idAttr:"data-tp-containable-upload-field-id",labelAttr:"data-tp-containable-upload-field-label",sizesAttr:"data-tp-containable-upload-field-sizes",fullAttr:"data-tp-containable-upload-field-full",thumbnailAttr:"data-tp-containable-upload-field-thumbnail"}},sortable:{axis:"y",items:"[data-tp-containable]",handle:"[data-tp-containable-handle]",cancel:"input, button",helper:"original"}},buttons:"[data-tp-containables-insert]",templates:{item:"[data-tp-containable-template]",dataNameAttr:"tp-containable-template"}};var d={tabAttr:"data-tp-tab",tabContentAttr:"data-tp-tab-content"};var b={toggleAttr:"data-tp-toggle",toggleableAttr:"data-tp-toggleable"};var c={body:"[data-tp-paginate-body]",next:"[data-tp-paginate-next]",buttons:"[data-tp-paginate-button]",previous:"[data-tp-paginate-previous]",last:"[data-tp-paginate-last]",first:"[data-tp-paginate-first]",count:"[data-tp-paginate-count]",action:"[data-tp-paginate-action]"};var a={dataAttr:"data-tp-chart-data",typeAttr:"data-tp-chart-type",chartOptions:{PieChart:{pieHole:0.5,legend:{position:"labeled"},chartArea:{width:"90%",height:"90%"},pieSliceText:"none",vAxis:{format:"short"},hAxis:{format:"short"}},LineChart:{pointSize:6,curveType:"none",legend:{position:"none"},chartArea:{width:"90%",height:"70%"},vAxis:{format:"short",baselineColor:"#aaaaaa"},hAxis:{format:"short"}},BarChart:{sStacked:true,legend:{position:"top",maxLines:3},vAxis:{format:"short"},hAxis:{format:"short"}}}};var e={action:"[data-tp-statistics-action]",progressBar:"[data-tp-statistics-progress-bar]"};this.containers=function(){jQuery("[data-tp-container]").each(function(){if(jQuery(this).data("container_instance")===undefined){jQuery(this).data("container_instance",new TotalPoll.API.Container(this,f))}})};this.tabs=function(){jQuery("[data-tp-tabs]").each(function(){if(jQuery(this).data("tabs_instance")===undefined){jQuery(this).data("tabs_instance",new TotalPoll.API.Tabs(this,d))}})};this.toggleables=function(){jQuery("[data-tp-toggleables]").each(function(){if(jQuery(this).data("toggleables_instance")===undefined){jQuery(this).data("toggleables_instance",new TotalPoll.API.Toggleables(this,b))}})};this.paginate=function(){jQuery("[data-tp-paginate]").each(function(){if(jQuery(this).data("paginate_instance")===undefined){jQuery(this).data("paginate_instance",new TotalPoll.API.Paginate(this,c))}})};this.statistics=function(){jQuery("[data-tp-statistics]").each(function(){if(jQuery(this).data("progress_instance")===undefined){jQuery(this).data("progress_instance",new TotalPoll.API.Statistics(this,e))}})};this.charts=function(){jQuery("[data-tp-chart-canvas]").each(function(){jQuery(this).data("chart_instance",new TotalPoll.API.Chart(this,a))})};this.fields=function(){jQuery("[data-tp-field-color]").wpColorPicker();jQuery("[data-tp-field-date]").datetimepicker({mask:true,format:"m/d/Y H:i",validateOnBlur:false})};this.reset=function(){jQuery("[data-tp-reset-votes]").on("click",function(){if(confirm(TotalPoll.i18n.sure)){jQuery("[data-tp-containable-votes]").val(0);jQuery('input[name="totalpoll[settings][limitations][unique_id]"]').prop("checked",true)}})};this.bulk=function(){var j=jQuery("[data-tp-bulk-container]");var i=jQuery("[data-tp-insert-bulk]");var h=jQuery("[data-tp-insert-bulk-choices]");var g=jQuery("[data-tp-insert-bulk-import]");i.on("click",function(){j.show()});g.on("click",function(){j.hide();var m=h.val().split("\n");var k=jQuery("[data-tp-choices]").data("container_instance");var l;jQuery.each(m,function(n,o){l=k.insert(k.templates["choices-text"]);l.$content.find('input[name*="label"]').attr("value",o).trigger("change")});h.val("")})};this.templates=function(){jQuery("[data-tp-templates]").on("keydown mousedown",function(g){g.target.lastSelectedIndex=g.target.selectedIndex}).on("change",function(g){if(confirm(TotalPoll.i18n.change_template)){jQuery("#publish").click()}else{g.target.selectedIndex=g.target.lastSelectedIndex;g.target.checked=false}})};this.containers();this.tabs();this.toggleables();this.paginate();this.statistics();this.fields();this.templates();this.reset();this.bulk();if(window.google!==undefined){google.setOnLoadCallback(this.charts)}return this};jQuery(function(){TotalPoll.readyCallback=new TotalPoll.onReady();jQuery(window).on("resize",function(){TotalPoll.readyCallback.charts()})});